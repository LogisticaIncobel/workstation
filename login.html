
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LOGIN • Incobel</title>
  <style>
:root{
  --brand:#0e5ec3; --bg1:#051c3a; --bg2:#08325f; --bg3:#0a3e76;
  --panel:rgba(255,255,255,.06); --line:rgba(255,255,255,.18);
  --text:#f2f6fb; --muted:#c7d6ea; --btn:#89c3ff; --btn-text:#0a1b33;
  --radius:14px; --shadow:0 12px 28px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,var(--bg1), var(--bg2) 60%, var(--bg3));
     font:15px/1.45 system-ui,Segoe UI,Roboto,Arial;color:var(--text)}
header{display:flex;align-items:center;gap:12px;padding:10px 14px;border-bottom:1px solid var(--line);background:var(--panel)}
header img.logo{height:34px;width:auto}
header .title{font-weight:800;letter-spacing:.5px}
.container{max-width:680px;margin:0 auto;padding:14px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
label{font-weight:700;font-size:13px}
input[type="text"]{width:100%;background:#032243;color:var(--text);border:1px solid var(--line);border-radius:12px;padding:10px 12px;outline:none}
input[type="text"]:focus{border-color:#7fb6ff;box-shadow:0 0 0 3px rgba(127,182,255,.25)}
button{background:var(--btn);color:var(--btn-text);border:none;border-radius:12px;font-weight:800;padding:12px 16px;cursor:pointer}
button:hover{filter:brightness(1.05)}
.hint{font-size:12px;color:#c7d6ea}
.error{color:#ffd5d5}
.success{color:#bbf7d0}
.grid2{display:grid;grid-template-columns:1fr auto;gap:12px}
</style>
</head>
<body>
  <header><img class="logo" src="LOGO.png" alt="Logo"><div class="title">LOGIN</div></header>
  <div class="container">
    <div class="card">
      <div class="grid2">
        <div>
          <label for="cpf">CPF</label>
          <input type="text" id="cpf" placeholder="000.000.000-00" inputmode="numeric" maxlength="14">
          <div id="msg" class="hint">Digite seu CPF e clique em Entrar.</div>
        </div>
        <div style="display:grid;align-content:end">
          <button id="btn-enter">Entrar</button>
        </div>
      </div>
    </div>
  </div>
<script>
const CSV_URL='dados.csv';
function maskCPF(el){let v=el.value.replace(/\D/g,'').slice(0,11);
 if(v.length>9)v=v.replace(/^(\d{3})(\d{3})(\d{3})(\d{0,2}).*$/,'$1.$2.$3-$4');
 else if(v.length>6)v=v.replace(/^(\d{3})(\d{3})(\d{0,3}).*$/,'$1.$2.$3');
 else if(v.length>3)v=v.replace(/^(\d{3})(\d{0,3}).*$/,'$1.$2'); el.value=v;}
document.getElementById('cpf').addEventListener('input',e=>maskCPF(e.target));
function onlyDigits(s){return (s||'').replace(/\D/g,'');}
function detectDelimiter(headerLine){return (headerLine.indexOf(';')>-1)?';':(headerLine.indexOf(',')>-1?',':';');}
function parseCSVForCPFs(text){
  text=text.replace(/^\uFEFF/,'');
  text=text.replace(/\r\n/g,'\n').replace(/\r/g,'\n');
  const DEL=detectDelimiter(text.split('\n')[0]);
  const lines=text.split('\n').filter(Boolean);
  const headers=lines.shift().split(DEL).map(s=>s.trim());
  const idxCPF = headers.findIndex(h=>/^(cpf|CPF)$/.test(h));
  const idxMot = headers.findIndex(h=>/^(MOTORISTA|motorista)$/.test(h));
  const list=[];
  for(const ln of lines){
    const cols = ln.split(DEL);
    const cpf = (cols[idxCPF]||'').trim();
    const mot = (cols[idxMot]||'').trim();
    if(cpf) list.push({digits: onlyDigits(cpf), masked: cpf, mot});
  }
  return list;
}
async function validateAndLogin(){
  const masked=document.getElementById('cpf').value.trim();
  const msg=document.getElementById('msg');
  if(!/^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(masked)){ msg.className='error'; msg.textContent='CPF inválido. Use 000.000.000-00.'; return; }
  const digits=onlyDigits(masked);
  msg.className='hint'; msg.textContent='Validando CPF no banco...';
  try{
    const res=await fetch(CSV_URL+'?v='+Date.now(),{cache:'no-store'});
    if(!res.ok) throw new Error('Não encontrei o dados.csv');
    const txt=await res.text();
    const cpfs=parseCSVForCPFs(txt);
    const found = cpfs.find(x=>x.digits===digits);
    if(!found){ msg.className='error'; msg.textContent='CPF não encontrado no CSV.'; return; }
    try{localStorage.setItem('ws_cpf_digits',digits); localStorage.setItem('ws_cpf_masked',masked); localStorage.setItem('ws_motorista', found.mot || '');}catch(e){}
    location.href='menu.html';
  }catch(err){
    msg.className='error'; msg.textContent='Erro: '+err.message;
  }
}
document.getElementById('btn-enter').addEventListener('click', validateAndLogin);
</script>
</body>
</html>
